<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hamster Game</title>
  <style>
    /* --- Global Styles --- */
    body {
      margin: 0;
      padding: 0;
      background: #FFC0CB;
      font-family: Arial, sans-serif;
    }
    /* --- Menu & Controls Screens --- */
    #menu, #controlsScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: #FFC0CB;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    #controlsScreen { display: none; }
    h1 { margin: 0 0 20px 0; font-size: 3em; color: #333; }
    .btn {
      background-color: #8B0000;
      color: #fff;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-size: 1.2em;
      cursor: pointer;
      margin: 10px;
      width: 150px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 8px rgba(0,0,0,0.4);
    }
    .button-container { display: flex; gap: 20px; }
    /* --- Fade Overlay (for transition) --- */
    #fadeOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      opacity: 0;
      z-index: 20;
      pointer-events: none;
      transition: opacity 1s;
    }
    /* --- Canvas --- */
    #gameCanvas {
      display: none;
      background: #FFC0CB;
    }
  </style>
</head>
<body>
  <!-- Menu Screen -->
  <div id="menu">
    <h1>Hello</h1>
    <div class="button-container">
      <button id="playButton" class="btn">Play</button>
      <button id="controlsButton" class="btn">Controls</button>
    </div>
  </div>
  <!-- Controls Screen -->
  <div id="controlsScreen">
    <h2>Controls</h2>
    <p>Use WASD to move:</p>
    <ul>
      <li>W: Move Up (positive Y-axis)</li>
      <li>A: Move Left (negative X-axis)</li>
      <li>S: Move Down (negative Y-axis)</li>
      <li>D: Move Right (positive X-axis)</li>
    </ul>
    <p>Press Space to attack.</p>
    <button id="backButton" class="btn">Back</button>
  </div>
  <!-- Game Canvas -->
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <!-- Fade Overlay -->
  <div id="fadeOverlay"></div>

  <script>
    /**********************
     * Global Variables
     **********************/
    let gameState = "menu"; // "menu", "controls", "game", "boss", "bossDefeated"
    const menuDiv = document.getElementById("menu");
    const controlsDiv = document.getElementById("controlsScreen");
    const playButton = document.getElementById("playButton");
    const controlsButton = document.getElementById("controlsButton");
    const backButton = document.getElementById("backButton");
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const fadeOverlay = document.getElementById("fadeOverlay");

    // Load images from the "images" folder
    const hamsterImg = new Image();
    hamsterImg.src = "images/Pi7_cropper.png";
    const bossImg = new Image();
    bossImg.src = "images/gojospritefight.gif";
    const bossUltImg = new Image();
    bossUltImg.src = "images/gojoult.gif";

    // Game objects
    let hamster = { x: 100, y: 300, width: 50, height: 50, speed: 3 };
    let projectiles = [];
    let enemy = null; // Will be created later
    let enemyProjectiles = [];
    let keysPressed = {};
    let bossSpawned = false;

    /**********************
     * Menu & Controls Events
     **********************/
    playButton.addEventListener("click", () => {
      startGameTransition();
    });
    controlsButton.addEventListener("click", () => {
      showControls();
    });
    backButton.addEventListener("click", () => {
      showMenu();
    });

    function showMenu() {
      menuDiv.style.display = "flex";
      controlsDiv.style.display = "none";
      canvas.style.display = "none";
      gameState = "menu";
    }
    function showControls() {
      menuDiv.style.display = "none";
      controlsDiv.style.display = "flex";
      canvas.style.display = "none";
      gameState = "controls";
    }

    /**********************
     * Transition to Game
     **********************/
    function startGameTransition() {
      // Fade to black
      menuDiv.style.display = "none";
      fadeOverlay.style.opacity = 1;
      setTimeout(() => {
        // Fade back to game
        fadeOverlay.style.opacity = 0;
        canvas.style.display = "block";
        gameState = "game";
        initGame();
      }, 1000);
    }

    /**********************
     * Game Initialization & Loop
     **********************/
    function initGame() {
      // Reset game objects
      hamster.x = 100;
      hamster.y = 300;
      projectiles = [];
      enemyProjectiles = [];
      enemy = null;
      bossSpawned = false;
      // Start game loop
      requestAnimationFrame(gameLoop);
    }

    window.addEventListener("keydown", (e) => {
      keysPressed[e.key.toLowerCase()] = true;
      // Fire projectile on space bar press
      if (e.key === " ") {
        shootProjectile();
      }
    });
    window.addEventListener("keyup", (e) => {
      keysPressed[e.key.toLowerCase()] = false;
    });

    function shootProjectile() {
      // Create a green projectile from hamster's right side
      projectiles.push({
        x: hamster.x + hamster.width,
        y: hamster.y + hamster.height / 2 - 5,
        width: 20,
        height: 10,
        speed: 8
      });
    }

    function gameLoop() {
      if (gameState !== "game" && gameState !== "boss") return;
      updateGame();
      drawGame();
      requestAnimationFrame(gameLoop);
    }

    function updateGame() {
      // Update hamster position (using standard coordinates: up = decrease y, left = decrease x, etc.)
      if (keysPressed["w"]) hamster.y -= hamster.speed;
      if (keysPressed["a"]) hamster.x -= hamster.speed;
      if (keysPressed["s"]) hamster.y += hamster.speed;
      if (keysPressed["d"]) hamster.x += hamster.speed;

      // Constrain hamster within canvas
      if (hamster.x < 0) hamster.x = 0;
      if (hamster.y < 0) hamster.y = 0;
      if (hamster.x + hamster.width > canvas.width)
        hamster.x = canvas.width - hamster.width;
      if (hamster.y + hamster.height > canvas.height)
        hamster.y = canvas.height - hamster.height;

      // Update hamster projectiles
      for (let i = projectiles.length - 1; i >= 0; i--) {
        projectiles[i].x += projectiles[i].speed;
        if (projectiles[i].x > canvas.width) projectiles.splice(i, 1);
      }

      // Spawn enemy (boss) when hamster reaches a threshold
      if (!bossSpawned && hamster.x > 400) {
        spawnEnemy();
      }

      // Update enemy if exists
      if (enemy) {
        // If enemy is nearly defeated, speed up
        if (enemy.health <= 1) {
          enemy.speed = 3;
        }
        enemy.x -= enemy.speed;
        enemy.shootTimer--;
        if (enemy.shootTimer <= 0) {
          shootEnemyProjectile();
          enemy.shootTimer = 60;
        }
        // Check collision: hamster projectiles hitting enemy
        for (let i = projectiles.length - 1; i >= 0; i--) {
          if (rectIntersect(projectiles[i], enemy)) {
            enemy.health--;
            projectiles.splice(i, 1);
            // When enemy is one hit away, show boss ult overlay (if not already shown)
            if (enemy.health === 1 && !enemy.ultDisplayed) {
              enemy.ultDisplayed = true;
              showBossUlt();
            }
            if (enemy.health <= 0) {
              // Enemy defeated
              gameState = "bossDefeated";
              setTimeout(() => {
                alert("You are the strongest...");
                enemy = null;
              }, 100);
            }
          }
        }
        // Update enemy projectiles
        for (let i = enemyProjectiles.length - 1; i >= 0; i--) {
          enemyProjectiles[i].x -= enemyProjectiles[i].speed;
          if (enemyProjectiles[i].x + enemyProjectiles[i].width < 0)
            enemyProjectiles.splice(i, 1);
          // Check collision with hamster
          if (rectIntersect(enemyProjectiles[i], hamster)) {
            console.log("Hamster hit!");
            enemyProjectiles.splice(i, 1);
          }
        }
      }
    }

    function drawGame() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw pink background
      ctx.fillStyle = "#FFC0CB";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      // Draw many small, random clouds
      drawSmallClouds();
      // Draw hamster sprite
      ctx.drawImage(hamsterImg, hamster.x, hamster.y, hamster.width, hamster.height);
      // Draw hamster projectiles (green)
      ctx.fillStyle = "green";
      projectiles.forEach(proj => {
        ctx.fillRect(proj.x, proj.y, proj.width, proj.height);
      });
      // Draw enemy if it exists
      if (enemy && !enemy.defeated) {
        ctx.drawImage(bossImg, enemy.x, enemy.y, enemy.width, enemy.height);
      }
      // Draw enemy projectiles
      enemyProjectiles.forEach(proj => {
        ctx.fillStyle = proj.color;
        ctx.fillRect(proj.x, proj.y, proj.width, proj.height);
      });
    }

    function drawSmallClouds() {
      // Draw 20 small clouds as white semi-transparent circles
      for (let i = 0; i < 20; i++) {
        let x = Math.random() * canvas.width;
        let y = Math.random() * canvas.height;
        let radius = Math.random() * 20 + 10;
        ctx.fillStyle = "rgba(255,255,255,0.7)";
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function spawnEnemy() {
      bossSpawned = true;
      enemy = {
        x: canvas.width,
        y: Math.random() * (canvas.height - 100),
        width: 100,
        height: 100,
        health: 10,
        speed: 1,
        shootTimer: 60,
        ultDisplayed: false
      };
      alert("grace, yowai mo");
    }

    function shootEnemyProjectile() {
      // Choose a random color from blue, red, or purple
      const colors = ["blue", "red", "purple"];
      let color = colors[Math.floor(Math.random() * colors.length)];
      // If enemy is nearly defeated and shooting purple, make projectile larger
      let size = (enemy.health <= 1 && color === "purple") ? 20 : 10;
      enemyProjectiles.push({
        x: enemy.x,
        y: enemy.y + enemy.height / 2 - size / 2,
        width: size,
        height: size,
        speed: 4,
        color: color
      });
    }

    function showBossUlt() {
      // Display the boss ultimate GIF ("gojoult.gif") full-screen once.
      let ultImg = new Image();
      ultImg.src = "images/gojoult.gif";
      ultImg.onload = () => {
        ctx.drawImage(ultImg, 0, 0, canvas.width, canvas.height);
        setTimeout(() => {
          // Here you might add a fade-out effect if desired.
        }, 1000);
      };
    }

    function rectIntersect(r1, r2) {
      return !(
        r2.x > r1.x + r1.width ||
        r2.x + r2.width < r1.x ||
        r2.y > r1.y + r1.height ||
        r2.y + r2.height < r1.y
      );
    }
  </script>
</body>
</html>
